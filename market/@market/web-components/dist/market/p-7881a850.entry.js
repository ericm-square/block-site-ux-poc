import{r as t,c as e,h as s,H as i,g as n}from"./p-c9795ae2.js";import{c as a}from"./p-8ccc0928.js";import{g as o}from"./p-a7d431c5.js";import{M as r}from"./p-930860a8.js";import{i as l}from"./p-50a22327.js";import{v as d}from"./p-19b890a3.js";const h=":host,::slotted(*),*{box-sizing:border-box}:host([disabled]){cursor:not-allowed !important;}:host([disabled]) *,:host([disabled]) ::slotted(*){cursor:not-allowed !important;pointer-events:none !important;}:host{display:inline-block}.dropdown,.dropdown>.filter-button{width:100%}.date-popover{max-width:unset;max-height:unset}";const c=h;const u=class{constructor(s){t(this,s);this.marketFilterClosed=e(this,"marketFilterClosed",7);this.marketFilterOpened=e(this,"marketFilterOpened",7);this.marketFilterExpandedChanged=e(this,"marketFilterExpandedChanged",7);this.marketFilterValueDidChange=e(this,"marketFilterValueDidChange",7);this.name=undefined;this.disabled=undefined;this.focused=false;this.size="medium";this.expanded=false;this.dropdownInteraction=undefined;this.popoverPlacement="bottom-start";this.popoverStrategy="absolute";this.selectedDisplayValue=undefined}async getFilterType(){return Promise.resolve(this.filterType)}async setFocus(t=true){this.focused=await this.filterButtonEl.setFocus(t);return Promise.resolve(this.focused)}async __setAndEmitListValue(t){var e;if(!this.listEl){return Promise.reject(new Error("No list found."))}const s=(e=this.listEl)===null||e===void 0?void 0:e.value;this.listEl.value=t;this.marketFilterValueDidChange.emit({name:this.name,prevValue:s||null,value:t});this.setDisplayValueFromSlottedElement();return Promise.resolve()}async __setAndEmitDatePickerValue(t){if(!this.datePickerEl){return Promise.reject(new Error("No date picker found."))}const e=this.datePickerEl.selectedStartDate;const s=this.datePickerEl.selectedEndDate;const i=t===null||t===void 0?void 0:t.startDate;const n=t===null||t===void 0?void 0:t.endDate;this.datePickerEl.selectedStartDate=i;this.datePickerEl.selectedEndDate=n;this.marketFilterValueDidChange.emit({name:this.name,prevValue:{startDate:e,endDate:s},value:{startDate:i,endDate:n}});this.setDisplayValueFromSlottedElement();return Promise.resolve()}handleListSelectionChange({detail:t}){var e;this.setDisplayValueFromListEvent(t);const s=t.prevSelectionValues.length>1?t.prevSelectionValues:t.prevSelectionValues[0];const i=(()=>{if(t.currentSelectionValues.length===0){return null}else if(t.currentSelectionValues.length===1){return t.currentSelectionValues[0]}return t.currentSelectionValues})();this.rawValue=i;this.marketFilterValueDidChange.emit({name:this.name,prevValue:s||null,value:i});if(!((e=this.listEl)===null||e===void 0?void 0:e.multiselect)&&!this.dropdownInteraction){this.expanded=false}}handleDateRangeChange(t){const{startDate:e,endDate:s,prevStartDate:i,prevEndDate:n}=t.detail;this.setDisplayValueFromDateEvent(t);this.marketFilterValueDidChange.emit({name:this.name,prevValue:{startDate:i,endDate:n},value:{startDate:e,endDate:s}})}handleDropdownOpened(t){if(t.target!==this.el)return;const{defaultPrevented:e}=this.marketFilterExpandedChanged.emit(true);if(e){t.preventDefault();return}if(this.marketFilterOpened.emit().defaultPrevented){t.preventDefault();return}if(!this.dropdownInteraction){this.expanded=true}}handleDropdownClosed(t){if(t.target!==this.el)return;const{defaultPrevented:e}=this.marketFilterExpandedChanged.emit(false);if(e){t.preventDefault();return}if(this.marketFilterClosed.emit().defaultPrevented){t.preventDefault();return}if(!this.dropdownInteraction){this.expanded=false}}handleDefaultSlotChange(){this.datePickerEl=this.el.querySelector(o("market-date-picker"));this.listEl=this.el.querySelector(o("market-list"));const t=`popover-${d()}`;if(this.datePickerEl){if(!this.datePickerEl.id){this.datePickerEl.id=t;this.popoverId=t}else{this.popoverId=this.datePickerEl.id}this.filterType="date";this.setDisplayValueFromSlottedElement()}else if(this.listEl){if(!this.listEl.interactive){this.listEl.interactive=true}if(!this.listEl.id){this.listEl.id=t;this.popoverId=t}else{this.popoverId=this.listEl.id}this.filterType="list";this.setDisplayValueFromSlottedElement()}}initRowObservers(){const t=t=>{if(typeof this.rawValue==="string"&&t.value===this.rawValue){this.selectedDisplayValue=this.getTextContentOfRowWithValue(t.value)}};const e=this.el.querySelectorAll(`${o("market-list")} ${o("market-row")}`);e.forEach((e=>{const s=new MutationObserver((()=>t(e)));s.observe(e,{characterData:true,subtree:true})}))}getTextContentOfRowWithValue(t){const e=o("market-row");const s=this.listEl.querySelector(`${e}[value="${t}"] [slot="label"]`);return s===null||s===void 0?void 0:s.textContent}setDisplayValueFromSlottedElement(){const t=this.el.querySelector('[slot="display-value"]');const e=Boolean(t);if(e){this.selectedDisplayValue=t.textContent;return}if(this.listEl){if(!this.listEl.value){this.selectedDisplayValue=undefined;return}this.rawValue=this.listEl.value;if(this.listEl.multiselect){const t=(()=>{if(typeof this.listEl.value==="string"){return this.listEl.value.split(",").length}else if(Array.isArray(this.listEl.value)){return this.listEl.value.length}return undefined})();if(t>1){this.selectedDisplayValue=`${t}`;return}}this.selectedDisplayValue=this.getTextContentOfRowWithValue(this.listEl.value)}else if(this.datePickerEl){this.selectedDisplayValue=this.formatDate({startDate:this.datePickerEl.selectedStartDate,endDate:this.datePickerEl.selectedEndDate})}}formatDate({startDate:t,endDate:e}){var s,i;const n=t?new Date(t):undefined;const a=e?new Date(e):undefined;if(!n&&!a){return""}const o=this.datePickerEl.locale;const r=Boolean(n&&a&&n.getFullYear()===a.getFullYear());const l=(s=n===null||n===void 0?void 0:n.toLocaleDateString(o,r&&a?{day:"numeric",month:"numeric"}:{dateStyle:"short"}))!==null&&s!==void 0?s:"";const d=(i=a===null||a===void 0?void 0:a.toLocaleDateString(o,{dateStyle:"short"}))!==null&&i!==void 0?i:"";return`${l}${d?`â€“${d}`:""}`}setDisplayValueFromDateEvent(t){var e,s,i,n;const{menuSelection:a}=t.detail;if(a===r.CUSTOM){this.selectedDisplayValue=this.formatDate(t.detail)}else if(a){const t=(n=(i=(s=(e=this.datePickerEl)===null||e===void 0?void 0:e.shadowRoot)===null||s===void 0?void 0:s.querySelector(`${o("market-date-picker-menu")} slot[name="${a}"]`))===null||i===void 0?void 0:i.textContent)===null||n===void 0?void 0:n.trim();this.selectedDisplayValue=t}}setDisplayValueFromListEvent({currentSelectionValues:t,currentSelections:e}){const s=this.el.querySelector('[slot="display-value"]');const i=Boolean(s);if(i){this.selectedDisplayValue=s.textContent;return}if(!(t===null||t===void 0?void 0:t.length)){this.selectedDisplayValue=undefined}else if(t.length>1){this.selectedDisplayValue=`${t.length}`}else{const t=e[0].querySelector('[slot="label"]');this.selectedDisplayValue=t.textContent}}connectedCallback(){this.initRowObservers();this.handleDefaultSlotChange()}render(){var t;const{datePickerEl:e,disabled:n,dropdownInteraction:r,expanded:d,handleDefaultSlotChange:h,listEl:c,popoverId:u,popoverPlacement:f,popoverStrategy:p,selectedDisplayValue:v,size:m}=this;const b=(t=c===null||c===void 0?void 0:c.multiselect)!==null&&t!==void 0?t:false;const k=Boolean(e);const D=r!==null&&r!==void 0?r:k||b?"persistent":undefined;const y=o("market-dropdown");const g=o("market-popover");const w=o("market-filter-button");return s(i,{key:"232446ed830e3feb776c691d0c77a27a13730e07",class:"market-filter"},s(y,{key:"eeb8a4bfe3a2d0a2c8ecf73787e0de2105137ca2",class:"dropdown",disabled:n,expanded:d,interaction:D,popoverPlacement:f,popoverStrategy:p},s(w,{key:"7f34007cbf900c11b76d70d4b8ca5a341b0c69b7",active:d,class:"filter-button",disabled:n,ref:t=>this.filterButtonEl=t,slot:"trigger",size:m,popoverId:u},s("slot",{key:"d69a920b6ece024223e9b41f938ded48d7581cd9",name:"label"}),!l(v)&&s("span",{key:"b780be1b15399455522269be98a395af03f64c8b",slot:"feedback"},s("slot",{key:"92193310039dd4006cb34d945403f2f62aca4349",name:"display-value"},v))),s(g,{key:"8e1d32d1b6782be2fc9ddc3e09dec981adce7613",class:a({"date-popover":k}),slot:"popover",id:u},s("slot",{key:"41b3895ba903e29b90063a3085a60ab0aa16bb75",onSlotchange:h.bind(this)}),s("slot",{key:"08001b6b66a5bbc79e9e8c9ad51f285baa19ecd3",name:"list",onSlotchange:h.bind(this)}))))}get el(){return n(this)}};u.style=c;export{u as market_filter};
//# sourceMappingURL=p-7881a850.entry.js.map