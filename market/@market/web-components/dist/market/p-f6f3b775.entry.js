import{r as t,h as i,H as s,g as o}from"./p-c9795ae2.js";import{c as e}from"./p-52c3ceb3.js";import{g as n,i as l}from"./p-a7d431c5.js";import{a as r}from"./p-e5f35127.js";import{t as d}from"./p-a6d610dc.js";import"./p-632cbbe7.js";import"./p-c4e5a9dd.js";const a=':host,::slotted(*),*{box-sizing:border-box}:host([disabled]){cursor:not-allowed !important;}:host([disabled]) *,:host([disabled]) ::slotted(*){cursor:not-allowed !important;pointer-events:none !important;}:host{--filter-group-margin:var(--core-metrics-spacing-200);--filter-group-search-width:280px;display:flex;margin:var(--filter-group-margin)}.content{--filter-group-button-spacing:var(--core-metrics-spacing-100);display:flex;flex:1;flex-flow:row nowrap;gap:var(--filter-group-button-spacing, var(--core-metrics-spacing-100))}::slotted([slot="search"]){max-width:var(--filter-group-search-width)}::slotted([slot="search"]:not([compact])){min-width:var(--filter-group-search-width)}::slotted([slot="search"][focused]){flex:1 1 var(--filter-group-search-width)}@media (max-width: 599px){.content{justify-content:space-between}::slotted([slot="search"]){max-width:unset}::slotted([slot="search"][focused]){flex:1}::slotted([slot="filters"]){display:inline-flex;flex:1}}';const h=a;const c=3;const f=8;const v=50;const u=8;const p=16;const m=class{constructor(i){t(this,i);this._isSearchActive=false;this._willFocusOnFirstFilter=false;this._willDelayDropdownOpen=false;this._observers={};this.throttledHandleResize=d(this.handleResize.bind(this),p);this.maxVisibleFilters=3;this._sortedFilterEls={overflow:[],visible:[]}}maxVisibleFiltersWatcher(){this.handleResize()}marketInputSearchFocusHandler({detail:t}){this._isSearchActive=t}async marketInternalInputSearchCompactAnimationHandler(t){t.stopPropagation();await this.handleResize();await r();this._willDelayDropdownOpen=t.detail==="animationstart"}marketDropdownOpenedHandler(t){if(!this._willDelayDropdownOpen){return}this._willDelayDropdownOpen=false;t.preventDefault();setTimeout((async()=>{var t,i,s,o,e,l;await r();await((s=(i=(t=this._dropdownMenuEl)===null||t===void 0?void 0:t.shadowRoot)===null||i===void 0?void 0:i.querySelector(n("market-dropdown")))===null||s===void 0?void 0:s.updateDropdownPosition());(l=(e=(o=this._dropdownMenuEl)===null||o===void 0?void 0:o.shadowRoot)===null||e===void 0?void 0:e.querySelector(n("market-dropdown")))===null||l===void 0?void 0:l.openDropdown()}),e.CORE_ANIMATION_EXIT_TRANSITION_FAST_SPEED_DURATION*1.25)}calculateOverflowButtonWidth(t){if(!(t===null||t===void 0?void 0:t.length)){return 0}const i=t.reduce(((t,i)=>{const s=i.querySelector(n("market-list"));if(s===null||s===void 0?void 0:s.value){return t+1}const o=i.querySelector(n("market-date-picker"));if(o===null||o===void 0?void 0:o.selectedStartDate){return t+1}return t}),0);if(i===0){return v}const s=document.createElement("canvas");const o=s.getContext("2d");if(t[0].size==="small"){o.font=`${e.CORE_TYPE_PARAGRAPH_20_SIZE}px ${e.CORE_TYPE_PARAGRAPH_20_FONT_FAMILY}`}else{o.font=`${e.CORE_TYPE_PARAGRAPH_30_SIZE}px ${e.CORE_TYPE_PARAGRAPH_30_FONT_FAMILY}`}const l=o.measureText(`${i}`).width;s.remove();return v+u+l}getComputedWidth(t){return Number.parseFloat(window.getComputedStyle(t).width)}async findFilterCutoffIndex(){var t,i;if(((t=this.maxVisibleFilters)!==null&&t!==void 0?t:c)<=0){return 0}const s=(window===null||window===void 0?void 0:window.innerWidth)<=e.CORE_BREAKPOINT_NARROW_MAX_WIDTH;if(s&&!this._isSearchActive){return 1}else if(this._isSearchActive){return 0}const o=this.getComputedWidth(this.el);const n=this._slottedInputSearchEl?this.getComputedWidth(this._slottedInputSearchEl)+f:0;const l=document.createElement("div");l.style.width="auto";l.style.position="absolute";l.style.visibility="hidden";this.el.shadowRoot.appendChild(l);let d=0;let a=0;for(const t of this._filterEls){if(d===((i=this.maxVisibleFilters)!==null&&i!==void 0?i:c)){break}const s=d+1===this._filterEls.length?0:f+this.calculateOverflowButtonWidth(this._filterEls.slice(d));const e=t.cloneNode(true);e.style.display="block";l.appendChild(e);await r();const h=this.getComputedWidth(l);l.removeChild(e);a+=(d>0?f:0)+h;const v=n+a+s;if(v>=o){break}++d}this.el.shadowRoot.removeChild(l);l.remove();return d}sortVisibleAndOverflowFilters(){this._sortedFilterEls={visible:this._filterEls.slice(0,this._filterCutoffIndex),overflow:this._filterEls.slice(this._filterCutoffIndex)};this._sortedFilterEls.visible.forEach((t=>{if(t.style.display){t.style.removeProperty("display")}if(t.getAttribute("slot")!=="filters"){t.setAttribute("slot","filters")}}));this._sortedFilterEls.overflow.forEach((t=>{if(t.style.display!=="none"){t.style.display="none"}if(t.getAttribute("slot")!=="overflow-filters"){t.setAttribute("slot","overflow-filters")}}))}async handleResize(){if(!this.getComputedWidth(this.el)){return}const t=await this.findFilterCutoffIndex();const i=t!==this._filterCutoffIndex;if(i){this._filterCutoffIndex=t;await r();this.sortVisibleAndOverflowFilters();if(this._dropdownMenuEl){const t=this._dropdownMenuEl.querySelector(n("market-dropdown"));if(t===null||t===void 0?void 0:t.expanded){t===null||t===void 0?void 0:t.closeDropdown()}}}this.checkIfSearchShouldBeCompact()}async checkIfSearchShouldBeCompact(){var t,i;if(!this._slottedInputSearchEl||this._slottedInputSearchEl.hasAttribute("focused")){return}const s=(window===null||window===void 0?void 0:window.innerWidth)<=e.CORE_BREAKPOINT_NARROW_MAX_WIDTH;const o=Boolean((t=this._filterEls)===null||t===void 0?void 0:t.length);const n=this._filterEls.length>((i=this.maxVisibleFilters)!==null&&i!==void 0?i:c);const l=o&&(s||n);if(l!==this._slottedInputSearchEl.hasAttribute("compact")){if(this._slottedInputSearchEl.getAttribute("focused")){await this._slottedInputSearchEl.setFocus(false)}if(l){this._slottedInputSearchEl.setAttribute("compact","")}else{this._slottedInputSearchEl.removeAttribute("compact")}}}handleInputSearchTabKeydown(t){var i;if(t.key==="Tab"&&!t.shiftKey&&((i=this._filterEls)===null||i===void 0?void 0:i.length)){t.preventDefault();this._slottedInputSearchEl.blur();this._willFocusOnFirstFilter=true}}handleInputSearchFocus(){var t,i;const s=(i=(t=this._dropdownMenuEl)===null||t===void 0?void 0:t.shadowRoot)===null||i===void 0?void 0:i.querySelector(n("market-dropdown"));if(s===null||s===void 0?void 0:s.hasAttribute("expanded")){s.closeDropdown()}}registerSlottedInputSearch(){var t,i,s,o,e,n,l,r;(i=(t=this._slottedInputSearchEl)===null||t===void 0?void 0:t.removeEventListener)===null||i===void 0?void 0:i.call(t,"keydown",this.handleInputSearchTabKeydown);(o=(s=this._slottedInputSearchEl)===null||s===void 0?void 0:s.removeEventListener)===null||o===void 0?void 0:o.call(s,"focus",this.handleInputSearchFocus);this._slottedInputSearchEl=this.el.querySelector('[slot="search"]');(n=(e=this._slottedInputSearchEl)===null||e===void 0?void 0:e.addEventListener)===null||n===void 0?void 0:n.call(e,"keydown",this.handleInputSearchTabKeydown.bind(this));(r=(l=this._slottedInputSearchEl)===null||l===void 0?void 0:l.addEventListener)===null||r===void 0?void 0:r.call(l,"focus",this.handleInputSearchFocus.bind(this));this.checkIfSearchShouldBeCompact()}registerSlottedFilters(){this._filterEls=[...this.el.children].filter((t=>l(t,"market-filter")))}observeContent(t){if(!this._observers.content){this._observers.content=new ResizeObserver(this.throttledHandleResize);this._observers.content.observe(t)}}filtersOnSlotChangeHandler(){this.registerSlottedFilters();this.handleResize()}connectedCallback(){if(!this._observers.host){this._observers.host=new ResizeObserver(this.throttledHandleResize);this._observers.host.observe(this.el)}}componentWillLoad(){this.registerSlottedFilters();this.registerSlottedInputSearch();this.handleResize()}componentWillRender(){var t,i,s;if(this._willFocusOnFirstFilter){(s=(i=(t=this._filterEls)===null||t===void 0?void 0:t[0])===null||i===void 0?void 0:i.setFocus)===null||s===void 0?void 0:s.call(i);this._willFocusOnFirstFilter=false}}disconnectedCallback(){Object.entries(this._observers).forEach((([t,i])=>{if(i){i.disconnect();this._observers[t]=undefined}}))}render(){var t,o;const e=(o=(t=this._filterEls)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.size;const l=n("market-filter-dropdown-menu");return i(s,{key:"bcebdf2c66d61a3bdf5b7e68b049ae8aef8d592b",class:"market-filter-group"},i("div",{key:"54f3edb35faf0ebabc85d5564f15d144aa8405d2",class:"content",ref:t=>this.observeContent(t)},i("slot",{key:"0f0f1052cf9714fbf3dd9d134fb509979bd8f03a",name:"search",onSlotchange:()=>this.registerSlottedInputSearch()}),i("slot",{key:"30813cd9185d3cf5728e7fe20e90e3cda4bb3388",name:"filters",onSlotchange:()=>this.filtersOnSlotChangeHandler()}),this._sortedFilterEls.overflow.length>0&&i(l,{key:"7db61ce101fcd40d802ccfb58f238c61312b857a",class:"dropdown-menu",size:e,ref:t=>this._dropdownMenuEl=t},i("slot",{key:"6f0d43ea458edc1181a046ab7d261aabd4f0b5f8",name:"overflow-filters",slot:"overflow-filters"}))))}get el(){return o(this)}static get watchers(){return{maxVisibleFilters:["maxVisibleFiltersWatcher"]}}};m.style=h;export{m as market_filter_group};
//# sourceMappingURL=p-f6f3b775.entry.js.map