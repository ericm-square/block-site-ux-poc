import{r as t,c as e,h as i,H as s,g as a}from"./p-c9795ae2.js";import{c as o}from"./p-52c3ceb3.js";import{D as r,A as n}from"./p-3c1e3098.js";import{g as h}from"./p-a7d431c5.js";const c=":host,::slotted(*),*{box-sizing:border-box}:host([disabled]){cursor:not-allowed !important;}:host([disabled]) *,:host([disabled]) ::slotted(*){cursor:not-allowed !important;pointer-events:none !important;}:host{position:absolute;display:grid;justify-items:center;width:100vw;height:100%;animation:var(--core-animation-enter-transition-moderate-speed-duration)\n    market-fade-in\n    forwards\n    var(--core-animation-enter-transition-easing)}:host([hidden]){opacity:0%;animation-name:market-fade-out;animation-duration:var(--core-animation-exit-transition-moderate-speed-duration);animation-timing-function:var(--core-animation-exit-transition-easing)}:host>*{pointer-events:auto}:host(:not(.no-veil)){background-color:var(--core-surface-overlay-color);opacity:100%;pointer-events:auto}:host(.no-veil){pointer-events:none}@media screen and (min-width: 800px){::slotted(.market-modal-partial){align-self:center;margin:var(--modal-partial-vertical-screen-buffer-size) var(--modal-partial-horizontal-screen-buffer-size)}}::slotted(.market-dialog){align-self:center;width:calc(100% - (2 * var(--modal-dialog-horizontal-screen-buffer-size, 16px)))}";const l=c;const d=class{constructor(i){t(this,i);this.marketContextContentsChanged=e(this,"marketContextContentsChanged",7);this.marketContextEmptied=e(this,"marketContextEmptied",7);this.currentDialog=undefined;this.noVeil=false;this.hidden=false;this.animationEnterDuration=o.CORE_ANIMATION_ENTER_TRANSITION_MODERATE_SPEED_DURATION;this.animationExitDuration=o.CORE_ANIMATION_EXIT_TRANSITION_MODERATE_SPEED_DURATION;this.stack=[];this.totalCount=0;this.dialogMeta={}}currentDialogWatcher(t){this.stack.push(t);this.stack=[...this.stack]}stackWatcher(t){t.forEach((t=>{this.dialogMeta[t.type].count+=1;this.totalCount+=1}));if(t.length===0){this.hidden=true;setTimeout((()=>{this.marketContextEmptied.emit()}),this.animationExitDuration)}this.setContextVeil()}doesStackContainDialogThatRequiresVeil(t){const e=Object.entries(r).filter((([,t])=>t.veil)).map((([t])=>h(`market-${t}`)));return e.includes(t.tagName.toLowerCase())}setContextVeil(){if(this.el.hasAttribute("no-veil")||this.stack.length===0){return}this.noVeil=!this.stack.some((t=>this.doesStackContainDialogThatRequiresVeil(t.el)))}stackHasDialog(t){return this.stack.some((e=>e.el===t))}modalLoadedEventHandler(t){const e=t.detail.dialog;const i=t.detail.type;if(e.parentElement!==this.el){return}else if(this.stackHasDialog(e)){return}const s=this.generateDialogID(i);e.dialogID=s;e.id=e.id||s;this.currentDialog={el:e,type:i,dialogID:e.dialogID,id:e.id,index:this.stack.length,indexOfType:this.dialogMeta[i].count+1};this.marketContextContentsChanged.emit({action:"marketNewDialogOpened",currentDialog:this.currentDialog,stack:this.stack})}dialogDismissedEventHandler(t){if(t.defaultPrevented){return}if(t.target.parentElement===this.el){this.close(t.detail.dialog.dialogID)}}generateDialogID(t){return`${t}-${this.dialogMeta[t].count+1}`}getDialogByID(t){return this.stack.find((e=>e.dialogID===t))}open(t){if(this.stack.length===0){this.noVeil=!this.doesStackContainDialogThatRequiresVeil(t)}this.el.appendChild(t);return Promise.resolve()}close(t){let e;const i=this.stack.indexOf(e);if(t){e=this.stack.find((e=>e.dialogID===t));!e&&console.warn(`Tried to close dialog with data-dialog-id "${t}" but none were found`)}else{e=this.currentDialog}if(e){if(e.type==="dialog"&&e.el.persistent){return Promise.resolve()}setTimeout((()=>{e.el.remove();this.stack.splice(i,1);this.stack=[...this.stack];this.marketContextContentsChanged.emit({action:"marketDialogClosed",currentDialog:e,stack:this.stack})}),e.el.animationExitDuration)}return Promise.resolve()}closeCurrent(){this.close();return Promise.resolve()}connectedCallback(){n.forEach((t=>{this.dialogMeta[t]={count:0}}))}render(){return i(s,{key:"2a0b56ee061c12442f50ceeaa8cb717817a0d1d5",class:`market-context ${this.noVeil?"no-veil":""}`},i("slot",{key:"12f97a955528ee801f1459cc9426f71b4a625025"}))}get el(){return a(this)}static get watchers(){return{currentDialog:["currentDialogWatcher"],stack:["stackWatcher"]}}};d.style=l;export{d as market_context};
//# sourceMappingURL=p-02381a6c.entry.js.map