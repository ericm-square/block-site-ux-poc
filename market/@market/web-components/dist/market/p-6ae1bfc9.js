import{g as t}from"./p-8e7315f7.js";import{a as e}from"./p-e5f35127.js";import{g as o}from"./p-a7d431c5.js";async function n(t,e){const o=getComputedStyle(t);const{transitionProperty:n}=o;const r=n.split(", ");return Promise.all(Object.keys(e).map((o=>{const n=e[o];return new Promise((e=>{if(!n)e();if(n===t.style[o])e();if(!r.includes(o)){t.style[o]=n;e()}const a=n=>{if(n.propertyName!==o)return;t.removeEventListener("transitionend",a);e()};t.addEventListener("transitionend",a);t.style[o]=n}))})))}function r(t){const e=t===null||t===void 0?void 0:t.tagName.toLowerCase();return Boolean(t&&e===o("market-table-v2-row"))}function a(t){const e=t===null||t===void 0?void 0:t.tagName.toLowerCase();return Boolean(t&&e===o("market-table-v2-group"))}function s(t){return Boolean(t&&t.dragEnabled!==undefined)}const l=Math.min(1e3/60);const i=24;const c=o("market-table-v2-group");class u{constructor(t,e){this.el=t;this.anchor=(e===null||e===void 0?void 0:e.anchor)||"none"}async start(o){this.canceled=false;const{x:s,y:l}=o;this.startCoords=this.previousCoords=o;const{el:i,anchor:c}=this;const u=a(i)?i.querySelector('[slot="parent"]'):i;const{top:d,right:p,left:f,width:g,height:b}=m(u);const v=i.parentElement;const w=document.elementsFromPoint(s,l)[0];const x=u.cloneNode(true);x.classList.add("market-drag-clone","market-drag-transitioning");this.source=v;this.target=w;this.clone=x;const k=!i.dispatchEvent(new CustomEvent("marketDragStart",{bubbles:true,cancelable:true,detail:Object.assign(Object.assign({},o),{el:i,source:v,target:w,clone:x})}));if(k){this.canceled=true;return}this.scrollParent=h(i);i.classList.add("market-drag-placeholder");Object.assign(x.style,{position:"fixed",opacity:0,transitionProperty:"none"});document.body.append(x);await e();const{width:y,height:$}=m(x);Object.assign(x.style,{opacity:"",width:`${g}px`,height:`${b}px`,top:`${d}px`,left:c!=="right"?`${f}px`:"auto",right:c!=="left"?`${window.innerWidth-p}px`:"auto",zIndex:`${t(document.body)+1}`});await e();x.style.transitionProperty="";if(r(x)){x.querySelector("market-table-v2-cell").classList.add("market-drag-clone-first-cell")}x.style.setProperty("--market-drag-clone-shadow-opacity","1");n(x,{top:`${d+(b-$)/2}px`,height:`${$}px`,width:c==="none"?`${g}px`:`${y}px`}).then((()=>{x.classList.remove("market-drag-transitioning")}))}move(t){const{el:e,clone:o,source:n,target:r,startCoords:a,previousCoords:s,canceled:l}=this;const{x:i,y:c}=t;if(l)return;if(!o)return;if(i===s.x&&c===s.y)return;this.previousCoords=t;const u=[...document.elementsFromPoint(i,c)].find((t=>!o.contains(t)));if(u!==r){r===null||r===void 0?void 0:r.dispatchEvent(new CustomEvent("marketDragLeave",{bubbles:true,detail:{x:i,y:c,el:e,source:n,target:r,clone:o}}));u===null||u===void 0?void 0:u.dispatchEvent(new CustomEvent("marketDragEnter",{bubbles:true,detail:{x:i,y:c,el:e,source:n,target:u,clone:o}}));this.target=u}u===null||u===void 0?void 0:u.dispatchEvent(new CustomEvent("marketDragMove",{bubbles:true,detail:{x:i,y:c,el:e,source:n,target:u,clone:o}}));const h=i-a.x;const d=c-a.y;Object.assign(o.style,{transform:`translate(${h}px, ${d}px)`});this.scroll()}async end(t){if(this.canceled)return;const{el:o,source:s,clone:l,anchor:i,scrollInterval:u}=this;const{x:h,y:d}=t;clearInterval(u);if(!l)return;const f=[...document.elementsFromPoint(h,d)].find((t=>!l.contains(t)));const g=!o.dispatchEvent(new CustomEvent("marketDragEnd",{bubbles:true,cancelable:true,detail:{x:h,y:d,el:o,source:s,target:f,clone:l}}));if(!g){f===null||f===void 0?void 0:f.dispatchEvent(new CustomEvent("marketDragDrop",{bubbles:true,cancelable:false,detail:{x:h,y:d,el:o,source:s,target:f,clone:l}}))}const b=p(o,`${c}[collapsed]`);const v=b&&b!==o;const w=v?b.querySelector('[slot="parent"]'):a(o)?o.querySelector('[slot="parent"]'):o;await e();const{top:x,right:k,left:y,width:$,height:C}=m(w);const{top:M,right:j,left:E,width:D,height:O}=m(l);const I=i==="left"?E-y:j-k;const P=M-x;Object.assign(l.style,{pointerEvents:"none",transitionProperty:"none",top:`${x}px`,left:i!=="right"?`${y}px`:"auto",right:i!=="left"?`${window.innerWidth-k}px`:"auto",width:`${D}px`,height:`${O}px`,transform:`translate(${I}px, ${P}px)`});await e();l.style.transitionProperty="";if(r(l)&&r(w)){l.querySelector("market-table-v2-cell").classList.remove("market-drag-clone-first-cell")}l.classList.add("market-drag-released","market-drag-transitioning");if(v)l.classList.add("market-drag-into-collapsed-group");l.style.removeProperty("--market-drag-clone-shadow-opacity");await e();await n(l,{width:`${$}px`,height:`${C}px`,transform:I||P?"translate(0, 0)":null});o.classList.remove("market-drag-placeholder");l.remove();o===null||o===void 0?void 0:o.dispatchEvent(new CustomEvent("marketDragComplete",{bubbles:true,cancelable:false,detail:{x:h,y:d,el:o,source:s,target:f,clone:l}}))}scroll(){const{clone:t,scrollParent:e,scrollInterval:o}=this;clearInterval(o);const{bottom:n,top:r,right:a,left:s}=m(t);const{bottom:c,top:u,right:h,left:p}=d(e);const f=n-c;const g=r-u;const b=f>0?Math.min(f/4,i):g<0?Math.max(g/4,-i):0;const v=a-h;const w=s-p;const x=v>0?Math.min(v/4,i):w<0?Math.max(w/4,-i):0;if(b!==0||x!==0){this.scrollInterval=setInterval((()=>{e.scrollBy({top:b,left:x})}),l)}}destroy(){this.el=null;this.clone=null;this.source=null;this.target=null;this.startCoords=null;this.canceled=null;this.scrollParent=null;this.scrollInterval=null;this.anchor=null}}function h(t){let e=t.parentElement;while(e!==document.documentElement){const{overflowY:t,overflowX:o}=getComputedStyle(e);const n=/(auto|scroll)/.test(t)&&e.scrollHeight>e.offsetHeight;const r=/(auto|scroll)/.test(o)&&e.scrollWidth>e.offsetWidth;if(n||r)return e;e=e.parentElement}return document.documentElement}function d(t){const{top:e,right:o,bottom:n,left:r}=m(t);if(t===document.documentElement){const t=0;const e=window.innerWidth;const o=window.innerHeight;const n=0;return{top:t,right:e,bottom:o,left:n}}return{top:e,right:o,bottom:n,left:r}}function p(t,e){let o;let n=t;while(n!==document.body){const t=n.closest(e);if(t)o=t;n=n.parentElement}return o}function m(t){const e=t.getBoundingClientRect();return{top:Math.round(e.top),right:Math.round(e.right),bottom:Math.round(e.bottom),left:Math.round(e.left),width:Math.round(e.width),height:Math.round(e.height)}}export{u as D,a,r as b,s as i};
//# sourceMappingURL=p-6ae1bfc9.js.map