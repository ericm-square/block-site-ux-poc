import{i as e,a as t,b as r}from"./p-6ae1bfc9.js";import{a as n}from"./p-e5f35127.js";var o;function s(e){return Boolean(e&&["internal","external"].includes(e.reorderable))}const a=300;class i{static createCursor(){const e=document.createElement("div");e.classList.add("market-drag-cursor");return e}constructor({el:e,accepts:t,event:r,mode:n}){this.el=e;this.accepts=t;this.event=r;this.mode=n}isValidDrag(t,r,n){const{el:o,accepts:a}=this;const i=r===null||r===void 0?void 0:r.closest('[reorderable="internal"], [reorderable="external"]');const l=n===null||n===void 0?void 0:n.closest('[reorderable="internal"], [reorderable="external"]');if(!e(t))return false;if(!s(i))return false;if(!s(l))return false;if(t.closest(a.join(","))!==t)return false;if(o!==i&&o!==l)return false;if(i!==l){const e=i.reorderable==="external"&&l.reorderable==="external";const t=c(i,l).closest('[reorderable="internal"], [reorderable="external"]');if(!e&&!t)return false}return true}dragMove(e){var s,i;const{el:l,accepts:c,tableGroupExpandTimeout:u}=this;const{y:d,el:f,source:m,target:p}=e.detail;const{cursor:h}=o;if(!this.isValidDrag(f,m,p))return;clearTimeout(u);(s=h.parentElement)===null||s===void 0?void 0:s.classList.remove("market-drag-cursor-parent");if(p===l){l.append(h);l.classList.add("market-drag-cursor-parent");return}const v=p.closest(c.join(","));if(!v)return;if(v===f)return;if(t(v)){const e=[...v.children].find((e=>r(e)&&e.slot==="parent"));const{top:o,height:s}=e.getBoundingClientRect();if(v.collapsible&&v.collapsed){const i=Math.round(o+s/3);const l=Math.round(o+s*2/3);if(d<i){v.before(h)}else if(d>l){v.after(h)}else{e.after(h);const o=[...v.children].filter((e=>(r(e)||t(e))&&!e.slot));if(o.length>0){this.tableGroupExpandTimeout=setTimeout((async()=>{await v.setCollapsed(false);await n();e.after(h)}),a)}}}else{const t=Math.round(o+s/2);if(d<t){v.before(h)}else{e.after(h)}}}else{const{top:e,height:t}=v.getBoundingClientRect();const r=Math.round(e+t/2);if(d<r){v.before(h)}else{v.after(h)}}(i=h.parentElement)===null||i===void 0?void 0:i.classList.add("market-drag-cursor-parent")}dragLeave(){var e;const{tableGroupExpandTimeout:t}=this;const{cursor:r}=o;(e=r.parentElement)===null||e===void 0?void 0:e.classList.remove("market-drag-cursor-parent");r.remove();clearTimeout(t)}dragEnd(e){const{el:t,accepts:r,event:n,tableGroupExpandTimeout:s}=this;const{el:a,source:i}=e.detail;const{cursor:c}=o;clearTimeout(s);const u=c.parentElement;if(!this.isValidDrag(a,i,u))return;const d=i===null||i===void 0?void 0:i.closest('[reorderable="internal"], [reorderable="external"]');const f=u===null||u===void 0?void 0:u.closest('[reorderable="internal"], [reorderable="external"]');if(d===f)return;e.stopImmediatePropagation();const m=l(t,r);const p=m.indexOf(a);const h=-1;const{defaultPrevented:v}=n.emit({item:a,oldIndex:p,newIndex:h});if(v){e.preventDefault();c.remove()}}async dragDrop(e){const{el:t,accepts:r,event:n,mode:s,tableGroupExpandTimeout:a}=this;const{el:i,source:c}=e.detail;const{cursor:u}=o;clearTimeout(a);const d=u.parentElement;if(t!==d)return;if(!this.isValidDrag(i,c,d))return;e.stopImmediatePropagation();d===null||d===void 0?void 0:d.classList.remove("market-drag-cursor-parent");if([u.previousElementSibling,u.nextElementSibling].includes(i)){u.remove();return}const f=l(d,r);const m=f.indexOf(i);const p=[...f];if(m>=0){p.splice(m,1)}const h=p.indexOf(u.previousElementSibling)+1;if(h===m){u.remove();return}const v=document.createElement("div");i.replaceWith(v);u.replaceWith(i);await new Promise((e=>i.addEventListener("marketDragComplete",e,{once:true})));if(s==="framework")v.replaceWith(i);const{defaultPrevented:x}=n.emit({item:i,oldIndex:m,newIndex:h});if(x&&s==="default")v.replaceWith(i);v.remove()}destroy(){o.cursor.remove();clearTimeout(this.tableGroupExpandTimeout);this.el=null;this.accepts=null;this.event=null;this.mode=null;this.tableGroupExpandTimeout=null}}o=i;i.cursor=o.createCursor();function l(t,r){const n=[];const o=r.map((e=>`:scope > ${e}`));t.querySelectorAll(o.join(",")).forEach((t=>{if(e(t))n.push(t)}));return n}function c(e,t){let r=e;while(r){if(r.contains(t)){return r}r=r.parentElement}return null}export{i as R};
//# sourceMappingURL=p-4628ce60.js.map