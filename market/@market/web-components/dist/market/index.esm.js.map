{"version":3,"names":["node","node_","_a","tagName","includes","componentOnReady","marketComponentsLoaded","async","elm","isMarketElement","Promise","resolve","call","then","value","setTimeout","children","shadowRootChildren","_c","_b","shadowRoot","childElements","filter","el","undefined","all","map"],"sources":["src/utils/e2e/is-market-element.ts","src/utils/e2e/market-components-loaded.ts"],"sourcesContent":["interface MarketElement extends Element {\n  componentOnReady: () => Promise<unknown>;\n}\n\nexport default function (node: Node): node is MarketElement {\n  const node_ = node as any;\n  return node_?.tagName?.includes('MARKET-') && typeof node_.componentOnReady === 'function';\n}\n","import isMarketElement from './is-market-element';\n\n/**\n * Returns a promise which does not resolve until all Market components in the\n * root element have loaded. Use before running your React tests to make sure\n * Market elements are ready to be interacted with.\n * Takes an Element as a param, which should represent a root node which holds all the Market components you need to test.\n * You can grab this by getting the baseElement property from the render results used with @testing-library/react.\n *\n * Adapted from prior art here:\n * https://github.com/ionic-team/stencil/blob/45388e95edb46ef357eb9ae37cd32bbb5bc1ed23/test/karma/test-app/util.ts#L88-L106\n *\n * @param {Element} domNode\n * @returns {Promise<void>}\n */\n\nconst marketComponentsLoaded = async (elm: Element) => {\n  if (!elm) {\n    return;\n  }\n\n  if (isMarketElement(elm)) {\n    await new Promise((resolve) => {\n      elm.componentOnReady?.().then((value) => {\n        resolve(value);\n      });\n      // Sometimes elements get destroyed before they resolve componentOnReady and then tests will timeout.\n      setTimeout(() => {\n        resolve(null);\n      }, 200);\n    });\n  }\n\n  const children = [...(elm.children ?? [])];\n  const shadowRootChildren = [...(elm.shadowRoot?.children ?? [])];\n\n  const childElements = [...children, ...shadowRootChildren].filter(\n    (el) =>\n      ![\n        // Market doesn't render inside of SVGs\n        'svg',\n        // Text nodes have an undefined tagName.\n        undefined,\n      ].includes(el.tagName),\n  );\n\n  await Promise.all(childElements.map((el) => marketComponentsLoaded(el)));\n};\n\nexport default marketComponentsLoaded;\n"],"mappings":"iEAIyBA,G,MACvB,MAAMC,EAAQD,EACd,QAAOE,EAAAD,IAAK,MAALA,SAAK,SAALA,EAAOE,WAAO,MAAAD,SAAA,SAAAA,EAAEE,SAAS,oBAAqBH,EAAMI,mBAAqB,UAClF,C,MCSMC,EAAyBC,MAAOC,I,UACpC,IAAKA,EAAK,CACR,M,CAGF,GAAIC,EAAgBD,GAAM,OAClB,IAAIE,SAASC,I,OACjBT,EAAAM,EAAIH,oBAAgB,MAAAH,SAAA,SAAAA,EAAAU,KAAAJ,GAAKK,MAAMC,IAC7BH,EAAQG,EAAM,IAGhBC,YAAW,KACTJ,EAAQ,KAAK,GACZ,IAAI,G,CAIX,MAAMK,EAAW,KAAKd,EAAAM,EAAIQ,YAAQ,MAAAd,SAAA,EAAAA,EAAI,IACtC,MAAMe,EAAqB,KAAKC,GAAAC,EAAAX,EAAIY,cAAU,MAAAD,SAAA,SAAAA,EAAEH,YAAQ,MAAAE,SAAA,EAAAA,EAAI,IAE5D,MAAMG,EAAgB,IAAIL,KAAaC,GAAoBK,QACxDC,IACE,CAEC,MAEAC,WACApB,SAASmB,EAAGpB,iBAGZO,QAAQe,IAAIJ,EAAcK,KAAKH,GAAOjB,EAAuBiB,KAAK,S"}