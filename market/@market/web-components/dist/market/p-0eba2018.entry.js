import{r as e,c as t,h as r,H as a,g as s}from"./p-c9795ae2.js";import{g as o}from"./p-a7d431c5.js";import{i as n,D as i}from"./p-6ae1bfc9.js";import{R as l}from"./p-4628ce60.js";import{s as d}from"./p-5446e664.js";import"./p-8e7315f7.js";import"./p-e5f35127.js";import"./p-051a0642.js";import"./p-d06038ab.js";const c=':host{--table-cell-horizontal-padding-size:8px;--table-cell-indent-size:40px;--drag-highlight-border-size:2px}:host,slot,.children{vertical-align:inherit;text-align:inherit}:host,.children{display:contents}:host([collapsible][collapsed]) .children{display:none}:host(.market-drag-cursor-parent[collapsible][collapsed]) ::slotted([slot="parent"]){position:relative;border-radius:var(--core-radius-10);background-color:var(--core-emphasis-40-color);outline:var(--drag-highlight-border-size) solid var(--core-emphasis-fill-color);outline-offset:calc(var(--drag-highlight-border-size) * -1)}::slotted(.market-drag-cursor){--drag-cursor-height:4px;position:absolute;right:0;left:calc(\n      var(--table-cell-horizontal-padding-size) +\n      (var(--drag-cursor-indent-level) + 1) * var(--table-cell-indent-size)\n    );display:block;height:0;outline:calc(var(--drag-cursor-height) / 2) solid var(--core-emphasis-fill-color);pointer-events:none}:host(.market-drag-placeholder) ::slotted(:not([slot="parent"])){display:none}';const h=c;const p=class{constructor(r){e(this,r);this.marketInternalTableV2GroupSelectionChange=t(this,"marketInternalTableV2GroupSelectionChange",7);this.marketTableV2RowsReordered=t(this,"marketTableV2RowsReordered",7);this.marketTableV2GroupCollapsedChange=t(this,"marketTableV2GroupCollapsedChange",7);this.collapsible=false;this.collapsed=false;this.dragEnabled=false;this.indent=0;this.reorderable=undefined;this.reorderMode="default";this.selected="false"}onMarketTableV2CellCaretClicked(e){e.stopPropagation();this.setCollapsed(!this.collapsed)}async onMarketTableV2SelectionChange(e){const{el:t,parent:r}=this;const{target:a,detail:s}=e;const{current:o}=s;if(a===t)return;e.stopImmediatePropagation();if(a===r){await this.setSelected(o)}else{await this.setSelectedFromChildEvent(e)}}async onDragHandleStart(e){e.stopImmediatePropagation();const{el:t,parent:r}=this;const{target:a,detail:s}=e;if(r!==a)return;const o=r.dragHandlePosition==="leading"?"left":"right";const n=new i(t,{anchor:o});this.drag=n;await n.start(s);r.classList.add("market-drag-placeholder")}onDragHandleMove(e){e.stopImmediatePropagation();const{parent:t,drag:r}=this;const{target:a,detail:s}=e;if(t!==a)return;r.move(s)}async onDragHandleDragEnd(e){e.stopImmediatePropagation();const{parent:t,drag:r}=this;const{target:a,detail:s}=e;if(t!==a)return;await r.end(s);t.classList.remove("market-drag-placeholder");r.destroy()}onDragMove(e){const{parent:t,reorder:r}=this;const{el:a}=e.detail;if(t===a)return;e.stopImmediatePropagation();r===null||r===void 0?void 0:r.dragMove(e)}onDragLeave(e){const{parent:t,reorder:r}=this;const{el:a}=e.detail;if(t===a)return;e.stopImmediatePropagation();r===null||r===void 0?void 0:r.dragLeave()}onDragEnd(e){const{parent:t,reorder:r}=this;const{el:a}=e.detail;if(t===a)return;r===null||r===void 0?void 0:r.dragEnd(e)}onDragDrop(e){const{parent:t,reorder:r}=this;const{el:a}=e.detail;if(t===a)return;r===null||r===void 0?void 0:r.dragDrop(e)}propagateNestedState(){const{parent:e,children:t,groups:r,rows:a,indent:s,collapsible:o,collapsed:n}=this;r.forEach((e=>{e.collapsible=o}));if(o){const i=t.length>0;if(e){e.caret=i?n?"down":"up":undefined;e.indent=i?s:s+1}r.forEach((e=>{e.indent=s+1;e.collapsible=o}));a.forEach((e=>{e.indent=s+2}))}else{if(e){e.caret=undefined;e.indent=s}t.forEach((e=>{e.indent=s+1}));r.forEach((e=>{e.collapsible=o}))}}watchDragEnabled(){const{parent:e,children:t,dragEnabled:r}=this;if(e)e.dragEnabled=r;t===null||t===void 0?void 0:t.forEach((e=>{e.dragEnabled=r}))}watchReorderable(){const{el:e,reorder:t,reorderable:r,reorderMode:a,marketTableV2RowsReordered:s}=this;t===null||t===void 0?void 0:t.destroy();const n=["internal","external"].includes(r);if(n){const t=o("market-table-v2-row");const r=o("market-table-v2-group");this.reorder=new l({el:e,accepts:[`${t}:not([header]):not([footer]):not([slot="parent"])`,r],event:s,mode:a})}this.syncDragEnabled()}async setSelected(e,{silent:t=false}={}){const{parent:r,children:a,marketInternalTableV2GroupSelectionChange:s,selected:o}=this;if(o===e)return Promise.resolve();if(!t){s.emit({current:e,previous:o})}this.selected=e;await(r===null||r===void 0?void 0:r.setSelected(e,{silent:true}));a===null||a===void 0?void 0:a.forEach((async t=>{await t.setSelected(e,{silent:true})}));return Promise.resolve()}async setCollapsed(e,{silent:t=false}={}){const{collapsed:r,collapsible:a,marketTableV2GroupCollapsedChange:s}=this;if(!a)return Promise.resolve();if(e===r)return Promise.resolve();this.collapsed=e;if(!t){const{defaultPrevented:t}=s.emit({previous:r,current:e});if(t)this.collapsed=r}return Promise.resolve()}async sort({order:e,column:t,strategy:r,format:a}){const{el:s,children:o,groups:n}=this;const i=d({items:o,order:e,column:t,strategy:r,format:a});n===null||n===void 0?void 0:n.forEach((s=>s.sort({order:e,column:t,strategy:r,format:a})));i.forEach((e=>{s.append(e)}));return Promise.resolve()}async setSelectedFromChildEvent(e){const{parent:t,children:r,marketInternalTableV2GroupSelectionChange:a,selected:s}=this;const{target:o,detail:n}=e;const{current:i}=n;const l=r.map((e=>{if(o===e)return i;return e.selected}));const d=l.every((e=>e==="true"))?"true":l.every((e=>e==="false"))?"false":"indeterminate";if(s===d)return;a.emit({current:d,previous:s});this.selected=d;await t.setSelected(d,{silent:true})}getElements(){this.parent=[...this.el.children].find((e=>e.tagName===o("market-table-v2-row").toUpperCase()&&e.slot==="parent"));this.rows=[...this.el.children].filter((e=>e.tagName===o("market-table-v2-row").toUpperCase()&&e.slot!=="parent"));this.groups=[...this.el.children].filter((e=>e.tagName===o("market-table-v2-group").toUpperCase()&&e.slot!=="parent"));this.children=[...this.groups,...this.rows]}getStyles(){const{indent:e}=this;return{"--drag-cursor-indent-level":e.toString()}}syncDragEnabled(){const{parent:e,rows:t,groups:r,reorderable:a,reorderMode:s}=this;const o=["internal","external"].includes(a);if(e)e.dragEnabled=o;t===null||t===void 0?void 0:t.forEach((e=>{if(!n(e))return;e.dragEnabled=o}));r===null||r===void 0?void 0:r.forEach((e=>{e.dragEnabled=o;e.reorderable=a;e.reorderMode=s}))}onSlotChange(){this.getElements();this.propagateNestedState();this.syncDragEnabled()}connectedCallback(){this.getElements();this.propagateNestedState();this.syncDragEnabled()}componentDidRender(){this.watchReorderable()}render(){return r(a,{key:"dabd9bc7e9c87046618544958c5fea00a375c631",class:"market-table-v2-group",style:this.getStyles()},r("slot",{key:"d5893440e44dc0014fd3921e5eb46f8e31a32813",name:"parent",onSlotchange:()=>this.onSlotChange()}),r("div",{key:"876dbab692978351ceb9f70358fe82b76d80d174",class:"children"},r("slot",{key:"11071473d3ca6f7b7619258c2bef6bcd987a4a95",onSlotchange:()=>this.onSlotChange()})))}get el(){return s(this)}static get watchers(){return{indent:["propagateNestedState"],collapsed:["propagateNestedState"],collapsible:["propagateNestedState"],dragEnabled:["watchDragEnabled"],reorderable:["watchReorderable"]}}};p.style=h;export{p as market_table_v2_group};
//# sourceMappingURL=p-0eba2018.entry.js.map