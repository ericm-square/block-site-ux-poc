{"version":3,"file":"market-filter-dropdown-menu.js","sourceRoot":"","sources":["../../../../../../src/components/market-filter-group/subcomponents/market-filter-dropdown-menu/market-filter-dropdown-menu.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Fragment, Host, h, Listen, Prop, State } from '@stencil/core';\n\nimport { classNames } from '../../../../utils/classnames';\nimport { getNamespacedTagFor } from '../../../../utils/namespace';\nimport { TMarketDateRangeChangedEventDetail } from '../../../market-date-picker/events';\nimport { TMarketListSelectionsDidChangeEventDetail } from '../../../market-list/events';\nimport { isValueEmpty } from '../../../market-list/utils';\n\n/**\n * @slot search - Search input, using `<market-input-search>`\n * @slot filters - Filters, using `<market-filter>`\n * @slot settings - Filter settings, using `<market-filter>`\n * @slot visible-filters - INTERNAL ONLY: Used by `<market-filter-group>` when programmatically arranging visible vs overflow\n * buttons based on available space.\n */\n@Component({\n  tag: 'market-filter-dropdown-menu',\n  styleUrl: 'market-filter-dropdown-menu.css',\n  shadow: true,\n})\nexport class MarketFilterDropdownMenu {\n  @Element() el: HTMLMarketFilterDropdownMenuElement;\n\n  /**\n   * The `<market-filter>` elements\n   */\n  private filterEls: HTMLMarketFilterElement[];\n\n  /**\n   * The filter rows\n   */\n  private filterRowEls: HTMLMarketRowElement[];\n\n  /**\n   * String for setting filter button size\n   */\n  @Prop({ reflect: true }) readonly size: 'medium' | 'small' = 'medium';\n\n  /**\n   * Display the number of filters with a selected value as feedback\n   */\n  @State() private filtersWithSelectedValue: number;\n\n  /**\n   * Active filter's `name` prop\n   */\n  @State() private hasSelectedFilter: boolean;\n\n  /**\n   * Is market-dropdown active\n   */\n  @State() private isDropdownActive: boolean;\n\n  /**\n   * Handle `marketDropdownOpened` emitted by `<market-dropdown>`\n   */\n  @Listen('marketDropdownOpened')\n  handleDropdownOpened(e: CustomEvent<void>) {\n    if (e.target !== this.el) return;\n    this.deselectFilter();\n    this.isDropdownActive = true;\n  }\n\n  /**\n   * Handle `marketDropdownClosed` emitted by `<market-dropdown>`\n   */\n  @Listen('marketDropdownClosed')\n  handleDropdownClosed(e: CustomEvent<void>) {\n    if (e.target !== this.el) return;\n    this.isDropdownActive = false;\n  }\n\n  /**\n   * Handle `marketHeaderNavigate` emitted by `<market-button>` when clicking the back button\n   */\n  @Listen('marketHeaderNavigate')\n  handleHeaderNavigate() {\n    this.deselectFilter();\n  }\n\n  /**\n   * Deselect filter\n   */\n  private deselectFilter() {\n    this.hasSelectedFilter = false;\n  }\n\n  /**\n   * Handle overflow-filters slot change\n   */\n  private handleOverflowFiltersSlotChange() {\n    this.filterEls = this.el\n      .querySelector<HTMLSlotElement>('[slot=\"overflow-filters\"]')\n      .assignedNodes() as HTMLMarketFilterElement[];\n\n    // create <market-row>s; and calculate how many filters have set `values`\n    this.createRowsFromFilters();\n    this.calculateFiltersWithSelectedValue();\n  }\n\n  /**\n   * Create rows from filter slots\n   */\n  private createRowsFromFilters() {\n    // no more filters, remove rows if they exist\n    if (!this.filterEls?.length) {\n      this.filterRowEls?.forEach((filterRowEl) => {\n        filterRowEl.remove();\n      });\n      return;\n    }\n\n    const filterRowElsByValue: { [value: string]: HTMLMarketRowElement } = (this.filterRowEls ?? []).reduce(\n      (result, rowEl) => {\n        result[rowEl.value] = rowEl;\n        return result;\n      },\n      {},\n    );\n    const filterNames = new Set<string>();\n    const rowsByName: { [key: string]: HTMLMarketRowElement } = {};\n\n    this.filterEls.forEach((filterEl) => {\n      const name = filterEl.name;\n      filterNames.add(name);\n\n      const currentRowEl = filterRowElsByValue[name];\n      if (currentRowEl) {\n        // recycle filter row with the same name if it exists\n        rowsByName[name] = currentRowEl;\n      } else {\n        // create new row element\n        const newRowEl = document.createElement(getNamespacedTagFor('market-row')) as HTMLMarketRowElement;\n        newRowEl.variant = 'drill';\n        newRowEl.interactive = true;\n        newRowEl.transient = true;\n        newRowEl.value = name;\n        newRowEl.size = this.size;\n        newRowEl.addEventListener('click', async () => {\n          await this.handleFilterSelection(newRowEl);\n        });\n        rowsByName[name] = newRowEl;\n      }\n\n      // create the row label\n      const label = rowsByName[name]?.querySelector('label');\n      label?.remove();\n      const filterLabelEl = filterEl.querySelector('label');\n      if (filterLabelEl) {\n        rowsByName[name].appendChild(filterLabelEl.cloneNode(true));\n      }\n\n      // disable the row if the filter is disabled\n      if (filterEl.disabled) {\n        rowsByName[name].disabled = true;\n      }\n\n      // assign the slot\n      rowsByName[name].setAttribute('slot', 'filter-row');\n    });\n\n    // remove rows that should not exist anymore\n    this.filterRowEls?.forEach((filterRowEl) => {\n      if (!filterNames.has(filterRowEl.value)) {\n        filterRowEl.remove();\n      }\n    });\n\n    // add the new rows to the DOM\n    this.filterRowEls = [...this.filterEls].map(({ name }) => rowsByName[name]);\n    this.filterRowEls.forEach((filterRowEl) => {\n      filterRowEl.setAttribute('slot', 'filter-rows');\n      this.el.appendChild(filterRowEl);\n    });\n  }\n\n  /**\n   * When a filter is selected, the popover content will show\n   * the selected filter's title and list selection\n   */\n  private async handleFilterSelection(rowEl: HTMLMarketRowElement) {\n    const value = rowEl.value;\n    this.hasSelectedFilter = true;\n\n    const filterEl: HTMLMarketFilterElement = this.filterEls.find((filterEl) => filterEl.name === value);\n\n    // clone the label\n    const labelEl = filterEl.querySelector('label');\n    const clonedLabelEl = labelEl.cloneNode(true) as HTMLLabelElement;\n    clonedLabelEl.setAttribute('slot', 'filter-title');\n\n    this.el.querySelector('[slot=\"filter-title\"]')?.remove();\n    this.el.appendChild(clonedLabelEl);\n\n    switch (await filterEl.getFilterType()) {\n      case 'date': {\n        // clone the date picker\n        const datePickerEl = filterEl.querySelector<HTMLMarketDatePickerDateElement>(\n          getNamespacedTagFor('market-date-picker'),\n        );\n        const clonedDatePickerEl = datePickerEl.cloneNode(true) as HTMLMarketDatePickerElement;\n        clonedDatePickerEl.setAttribute('slot', 'filter-options');\n        clonedDatePickerEl.addEventListener(\n          'marketDateRangeChanged',\n          (e: CustomEvent<TMarketDateRangeChangedEventDetail>) => {\n            this.handleDatePickerFilterSelection(e, filterEl);\n          },\n        );\n\n        this.el.querySelector('[slot=\"filter-options\"]')?.remove();\n        this.el.appendChild(clonedDatePickerEl);\n        break;\n      }\n      case 'list': {\n        // clone the list\n        const listEl = filterEl.querySelector<HTMLMarketListElement>(getNamespacedTagFor('market-list'));\n        const clonedListEl = listEl.cloneNode(true) as HTMLMarketListElement;\n        clonedListEl.setAttribute('slot', 'filter-options');\n        clonedListEl.addEventListener(\n          'marketListSelectionsDidChange',\n          (e: CustomEvent<TMarketListSelectionsDidChangeEventDetail>) => {\n            this.handleListFilterSelection(e, filterEl, listEl);\n          },\n        );\n\n        clonedListEl.setAttribute('interactive', '');\n        listEl.multiselect && clonedLabelEl.setAttribute('multiselect', '');\n\n        this.el.querySelector('[slot=\"filter-options\"]')?.remove();\n        this.el.appendChild(clonedListEl);\n        break;\n      }\n      default:\n        break;\n    }\n  }\n\n  private async handleDatePickerFilterSelection(\n    e: CustomEvent<TMarketDateRangeChangedEventDetail>,\n    filterEl: HTMLMarketFilterElement,\n  ) {\n    const { startDate, endDate } = e.detail;\n\n    await filterEl.__setAndEmitDatePickerValue({ startDate, endDate });\n\n    // after selecting, recalculate what we display as feedback\n    this.calculateFiltersWithSelectedValue();\n  }\n\n  private async handleListFilterSelection(\n    e: CustomEvent<TMarketListSelectionsDidChangeEventDetail>,\n    filterEl: HTMLMarketFilterElement,\n    listEl: HTMLMarketListElement,\n  ) {\n    // set the filter value, then automatically deselect if the list is not multiselect\n    const { currentSelectionValues } = e.detail;\n\n    await filterEl.__setAndEmitListValue(currentSelectionValues);\n    if (!listEl.multiselect) {\n      this.deselectFilter();\n    }\n\n    // after selecting, recalculate what we display as feedback\n    this.calculateFiltersWithSelectedValue();\n  }\n\n  /**\n   * Count how many filters with selected value\n   * and that count is displayed as feedback.\n   */\n  private calculateFiltersWithSelectedValue() {\n    this.filtersWithSelectedValue = [...(this.filterEls || [])].reduce((count, filterEl) => {\n      const list = filterEl.querySelector<HTMLMarketListElement>(getNamespacedTagFor('market-list'));\n      if (!isValueEmpty(list?.value)) {\n        return count + 1;\n      }\n      const datePicker = filterEl.querySelector<HTMLMarketDatePickerElement>(getNamespacedTagFor('market-date-picker'));\n      if (datePicker?.selectedStartDate) {\n        return count + 1;\n      }\n      return count;\n    }, 0);\n  }\n\n  componentDidLoad() {\n    this.handleOverflowFiltersSlotChange();\n  }\n\n  render() {\n    const { filtersWithSelectedValue, handleOverflowFiltersSlotChange, hasSelectedFilter, isDropdownActive, size } =\n      this;\n\n    const MarketButtonTagName = getNamespacedTagFor('market-button');\n    const MarketDropdownTagName = getNamespacedTagFor('market-dropdown');\n    const MarketFilterButtonTagName = getNamespacedTagFor('market-filter-button');\n    const MarketHeaderTagName = getNamespacedTagFor('market-header');\n    const MarketListTagName = getNamespacedTagFor('market-list');\n    const MarketPopoverTagName = getNamespacedTagFor('market-popover');\n    const MarketAccessoryTagName = getNamespacedTagFor('market-accessory');\n\n    return (\n      <Host class={classNames('market-filter-dropdown-menu', { 'show-options': hasSelectedFilter })}>\n        <MarketDropdownTagName interaction=\"persistent\" popoverPlacement=\"bottom-end\">\n          <MarketFilterButtonTagName active={isDropdownActive} iconOnly size={size} slot=\"trigger\">\n            {filtersWithSelectedValue && <span slot=\"feedback\">{filtersWithSelectedValue}</span>}\n          </MarketFilterButtonTagName>\n          <MarketPopoverTagName class=\"popover\" slot=\"popover\">\n            {!hasSelectedFilter ? (\n              <MarketListTagName class=\"filter-list\" interactive>\n                <slot name=\"filter-rows\"></slot>\n              </MarketListTagName>\n            ) : (\n              <Fragment>\n                <MarketHeaderTagName class=\"selection-header\">\n                  <MarketButtonTagName rank=\"secondary\" size=\"small\" slot=\"navigation\">\n                    <MarketAccessoryTagName slot=\"icon\">\n                      <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                        <path\n                          fill-rule=\"evenodd\"\n                          clip-rule=\"evenodd\"\n                          d=\"M4.29289 11.293C3.90237 11.6835 3.90237 12.3167 4.29289 12.7072L11.2929 19.7072L12.7071 18.293L7.41421 13.0001L19 13.0001V11.0001L7.41421 11.0001L12.7071 5.70718L11.2929 4.29297L4.29289 11.293Z\"\n                        />\n                      </svg>\n                    </MarketAccessoryTagName>\n                  </MarketButtonTagName>\n                  <slot name=\"filter-title\"></slot>\n                </MarketHeaderTagName>\n                <div class=\"filter-options-container\">\n                  <slot name=\"filter-options\"></slot>\n                </div>\n              </Fragment>\n            )}\n          </MarketPopoverTagName>\n        </MarketDropdownTagName>\n        {/**\n         * This is an invisible container where overflow filters are initially.\n         * Then they are \"moved\" to [slot=\"filter-rows\"] as <market-row>s\n         */}\n        <div class=\"overflow-filters\">\n          <slot name=\"overflow-filters\" onSlotchange={handleOverflowFiltersSlotChange.bind(this)}></slot>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}