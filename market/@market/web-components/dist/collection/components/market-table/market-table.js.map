{"version":3,"file":"market-table.js","sourceRoot":"","sources":["../../../../src/components/market-table/market-table.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, Element, State, Watch, Listen, h } from '@stencil/core';\nimport { isEqual, throttle } from 'lodash-es';\n\nimport { getNamespacedTagFor } from '../../utils/namespace';\nimport { parsedGridTemplateColumnValues } from './utils';\n\nconst RESIZE_DEBOUNCE_DURATION = 16; // 60fps\n\n/**\n * @slot - Default slot for all rows\n *\n * @slot header - Slot for header rows at the top of the table. Slotting a header row is required to set custom column\n * widths.\n *\n * **NOTE:** slotting rows into this area will not sticky rows to the top. Use `sticky` or\n * `stick-to=\"top\"` on the row element instead.\n *\n * @slot footer - Slot for footer rows at the bottom of the table\n *\n * **NOTE:** slotting rows into this area will not sticky rows to the bottom. Use `sticky` or\n * `stick-to=\"bottom\"` on the row element instead.\n */\n@Component({\n  tag: 'market-table',\n  styleUrl: 'market-table.css',\n  shadow: true,\n})\nexport class MarketTable {\n  @Element() el: HTMLMarketTableElement;\n\n  // CSSStyleDeclaration representing the HTMLMarketTableElement's currently computed styles\n  @State() styleDeclaration: CSSStyleDeclaration;\n\n  // An array of grid template values set by the consumer on the table itself\n  @State() gridColumnTemplate: Array<string>;\n\n  @State() allColumns: Array<HTMLMarketTableColumnElement> = [];\n  @State() visibleColumns: Array<HTMLMarketTableColumnElement> = [];\n  @State() columnsStuckLeft: Array<HTMLMarketTableColumnElement> = [];\n  @State() columnsStuckRight: Array<HTMLMarketTableColumnElement> = [];\n  @State() columnsUnstuck: Array<HTMLMarketTableColumnElement> = [];\n\n  @State() allRows: Array<HTMLMarketTableRowElement> = [];\n  @State() rowsStuckTop: Array<HTMLMarketTableRowElement> = [];\n  @State() rowsStuckBottom: Array<HTMLMarketTableRowElement> = [];\n  @State() rowsUnstuck: Array<HTMLMarketTableRowElement> = [];\n  @State() hasAccordionRows: boolean = false;\n\n  observers: {\n    resize?: ResizeObserver;\n    inlineStyle?: MutationObserver;\n    content?: MutationObserver;\n  } = {};\n\n  /* Everytime the computed CSS style for this element is updated, we want to\n    mutate the grid template definition, and save whatever template they have set\n    to our grid definition so we know what size the columns are */\n  @Watch('styleDeclaration')\n  styleDeclarationObserver(newValue: CSSStyleDeclaration, oldValue: CSSStyleDeclaration) {\n    /* lodash's `isEqual` should not be used on CSSStyleDeclaration as it's vulnerable to prototype pollution causing false negatives\n    and modifying the data in place. More at https://square.slack.com/archives/C06RMPM072N/p1717600186722089 */\n    if (newValue !== oldValue) {\n      /* unset this.gridColumnTemplate value when there is no explicit grid-template-columns style\n        in this situation, the computed value of grid-template-columns === the width of the element\n        https://developer.mozilla.org/en-US/docs/Web/CSS/computed_value */\n      if (newValue.getPropertyValue('grid-template-columns') === newValue.getPropertyValue('width')) {\n        this.gridColumnTemplate = [];\n        return;\n      }\n\n      /* when there is an explicit grid-template-columns style, update this.gridColumnTemplate */\n      const gridTemplateColumnsValue = parsedGridTemplateColumnValues(\n        newValue.getPropertyValue('grid-template-columns'),\n      );\n      if (!isEqual(gridTemplateColumnsValue, this.gridColumnTemplate)) {\n        this.gridColumnTemplate = gridTemplateColumnsValue;\n      }\n    }\n  }\n\n  /* When the grid template changes, forward it's value to the child sections.\n  Use an observer instead of binding in the template to prevent polluting\n  the DOM with unneeded attributes */\n  @Watch('gridColumnTemplate')\n  gridTemplateObserver(newValue: Array<string>, oldValue?: Array<string>) {\n    if (newValue !== oldValue) {\n      this.setColumnWidths(newValue);\n      this.updateGridLayout();\n    }\n  }\n\n  /* If the columns change, forward their values to the child rows, and update\n  the column count */\n  @Watch('allColumns')\n  @Watch('visibleColumns')\n  allColumnsObserver(columns: Array<HTMLMarketTableColumnElement>, oldValue?: Array<HTMLMarketTableColumnElement>) {\n    if (columns && (!oldValue || columns !== oldValue)) {\n      this.setColumnWidths(this.gridColumnTemplate);\n      this.forwardColumnPropertiesToCells(this.allColumns);\n      this.updateGridLayout();\n    }\n  }\n\n  @Watch('allRows')\n  allRowsObserver(rows: Array<HTMLMarketTableRowElement>, oldValue?: Array<HTMLMarketTableRowElement>) {\n    if (rows !== oldValue && rows) {\n      this.updateGridLayout();\n      this.forwardColumnPropertiesToCells(this.allColumns);\n      this.updateStickyRows();\n    }\n  }\n\n  @Watch('rowsStuckTop')\n  @Watch('rowsStuckBottom')\n  @Watch('rowsUnstuck')\n  stuckRowsObserver(newValue: Array<HTMLMarketTableRowElement>, oldValue: Array<HTMLMarketTableRowElement>) {\n    if (newValue !== oldValue) {\n      this.allRows.map((row) => row.classList.remove('buffer-row'));\n\n      if (this.rowsStuckTop.length > 0) {\n        this.rowsStuckTop[this.rowsStuckTop.length - 1].classList.add('buffer-row');\n      }\n      if (this.rowsUnstuck.length > 0 && this.rowsStuckBottom.length > 0) {\n        this.rowsUnstuck[this.rowsUnstuck.length - 1].classList.add('buffer-row');\n      }\n    }\n  }\n\n  @Listen('marketTableHeaderLoaded')\n  marketTableHeaderLoadedEventHandler({ detail }) {\n    this.allColumns = [...detail.columns];\n    this.checkColumnVisibility();\n  }\n\n  @Listen('marketTableRowStick')\n  marketTableRowStickEventHandler({ target, detail }) {\n    switch (detail.position) {\n      case 'top':\n        target.slot = 'sticky-header';\n        break;\n      case 'bottom':\n        target.slot = 'sticky-footer';\n        break;\n      default:\n        // eslint-disable-next-line no-console\n        console.warn('could not stick row to an unknown position');\n        break;\n    }\n    this.updateStickyRows();\n  }\n\n  @Listen('marketTableRowUnstick')\n  marketTableRowUnstickEventHandler({ target }) {\n    /* If the row was originally in a named slot, we want to put the\n    row back into that slot */\n    if (target.originalSlot) {\n      target.slot = target.originalSlot;\n\n      /* Otherwise we just remove the slot attribute so it will return\n    to the default slot */\n    } else {\n      target.removeAttribute('slot');\n    }\n    this.updateStickyRows();\n  }\n\n  @Listen('marketTableColumnStick')\n  async marketTableColumnStickEventHandler({ target, detail }) {\n    // Stick each cell to the correct side in the row\n    await Promise.all(\n      [...this.allRows].map(async (row) => {\n        await row._stickColumn(target.name, detail.position);\n      }),\n    );\n\n    this.updateGridLayout();\n  }\n\n  @Listen('marketTableColumnUnstick')\n  async marketTableColumnUnstickEventHandler({ target }) {\n    await Promise.all(\n      [...this.allRows].map(async (row) => {\n        await row._unstickColumn(target.name);\n      }),\n    );\n\n    this.updateGridLayout();\n  }\n\n  @Listen('marketTableColumnVisibilityChange')\n  marketTableColumnVisibilityChangeHandler({ detail }) {\n    this.checkColumnVisibility();\n    this.allRows.forEach((row) => row._syncColumnVisibilityWithCells(detail.columnName, detail.hidden));\n    this.detectStyleDeclaration();\n  }\n\n  checkColumnVisibility() {\n    this.visibleColumns = this.allColumns.filter((column) => !column.hidden);\n  }\n\n  setColumnWidths(gridTemplate: Array<string>) {\n    if (this.allColumns.length > 0) {\n      this.visibleColumns.forEach((column, i) => {\n        column.width = gridTemplate[i];\n      });\n    }\n  }\n\n  forwardColumnPropertiesToCells(columns) {\n    this.allRows.forEach((row) => (row.tableColumns = columns));\n  }\n\n  updateGridLayout() {\n    if (this.allColumns.length > 0) {\n      this.columnsUnstuck = this.visibleColumns.filter((column) => !column.stickTo);\n      this.columnsStuckLeft = this.visibleColumns.filter((column) => column.stickTo === 'left');\n      this.columnsStuckRight = this.visibleColumns.filter((column) => column.stickTo === 'right');\n\n      const mainGrid = this.columnsUnstuck.map((column) => column.width);\n      const leftGrid = this.columnsStuckLeft.map((column) => column.width);\n      const rightGrid = this.columnsStuckRight.map((column) => column.width);\n\n      if (this.allRows.length > 0) {\n        this.allRows.forEach((row) => {\n          row.gridTemplateMain = mainGrid;\n          row.gridTemplateLeft = leftGrid;\n          row.gridTemplateRight = rightGrid;\n        });\n      }\n    }\n  }\n\n  updateStickyRows() {\n    this.rowsStuckTop = this.allRows.filter((row) => (row.sticky && row.header) || row.stickTo === 'top');\n    this.rowsStuckBottom = this.allRows.filter((row) => (row.sticky && row.footer) || row.stickTo === 'bottom');\n    this.rowsUnstuck = this.allRows.filter((row) => !row.stickTo && !row.sticky);\n  }\n\n  /* If the slotted content of the table changes, we need to update\n  our saved copy of the section and column children */\n  handleSlotChange() {\n    // Get all the child rows\n    this.allRows = [...this.el.querySelectorAll<HTMLMarketTableRowElement>(getNamespacedTagFor('market-table-row'))];\n\n    // Check for root accordion fields or default to passed in prop\n    const hasAccordionElements =\n      [...this.el.children].some((element: HTMLMarketAccordionItemElement | HTMLMarketTableRowElement) => {\n        return element.tagName.toLowerCase() === getNamespacedTagFor('market-accordion-item');\n      }) || this.hasAccordionRows;\n\n    /* Set an index for each row so we have some sort of id and can track it\n    this will perhaps come in useful later when we need to add a row re-ordering\n    drag & drop feature (although we probably need some conditional, or to set\n    the index somewhere else than here) - jbiggs */\n    this.allRows.forEach((row) => {\n      row.index = Array.prototype.indexOf.call(this.allRows, row);\n      row.nested = hasAccordionElements;\n    });\n  }\n\n  /**\n   * Gets current CSSStyleDeclaration object for this.el (see styleDeclarationObserver)\n   */\n  private detectStyleDeclaration() {\n    this.styleDeclaration = window.getComputedStyle(this.el as HTMLElement);\n  }\n\n  private throttledDetectStyleDeclaration = throttle(this.detectStyleDeclaration.bind(this), RESIZE_DEBOUNCE_DURATION);\n\n  /**\n   * Supports setting dynamic column sizes using CSS media queries by recalculating column width on table resize\n   */\n  private initResizeObserver() {\n    if (!this.observers.resize) {\n      this.observers.resize = new ResizeObserver(() => {\n        window.requestAnimationFrame(() => {\n          this.throttledDetectStyleDeclaration();\n        });\n      });\n      this.observers.resize.observe(this.el);\n    }\n  }\n\n  /**\n   * Supports setting dynamic column widths by updating inline styles\n   */\n  private initInlineStyleObserver() {\n    if (!this.observers.inlineStyle) {\n      this.observers.inlineStyle = new MutationObserver(() => this.detectStyleDeclaration());\n      this.observers.inlineStyle.observe(this.el, {\n        attributes: true,\n        attributeFilter: ['style'],\n      });\n    }\n  }\n\n  /**\n   * since onSlotchange only fires on changes to the <Host> node itself (not changes to the child slots of the\n   * <market-table-area>s), we're using a mutation observer to listen for added rows or changes in row content\n   * https://github.com/ionic-team/stencil/issues/232#issuecomment-397871813\n   */\n  private initContentObserver() {\n    if (!this.observers.content) {\n      this.observers.content = new MutationObserver(() => this.handleSlotChange());\n      this.observers.content.observe(this.el, {\n        childList: true,\n        subtree: true,\n        characterData: true,\n      });\n    }\n  }\n\n  /* When the component loads, we need to check for a grid-template-columns\n  CSS declaration on the table, and also read the column children\n  Setting both of these will trigger watcher functions which forward these\n  values to the row children */\n  componentWillLoad() {\n    this.detectStyleDeclaration();\n    this.handleSlotChange();\n  }\n\n  componentDidLoad() {\n    this.initResizeObserver();\n    this.initInlineStyleObserver();\n    this.initContentObserver();\n  }\n\n  render() {\n    const MarketTableAreaTagName = getNamespacedTagFor('market-table-area');\n\n    return (\n      <Host class=\"market-table\" role=\"table\" onSlotchange={() => this.handleSlotChange()}>\n        <MarketTableAreaTagName orientation=\"horizontal\" stick-to=\"top\" active={this.rowsStuckTop.length > 0}>\n          <slot name=\"sticky-header\"></slot>\n        </MarketTableAreaTagName>\n        <MarketTableAreaTagName orientation=\"horizontal\" active>\n          <slot name=\"header\"></slot>\n          <slot></slot>\n          <slot name=\"footer\"></slot>\n        </MarketTableAreaTagName>\n        <MarketTableAreaTagName orientation=\"horizontal\" stick-to=\"bottom\" active={this.rowsStuckBottom.length > 0}>\n          <slot name=\"sticky-footer\"></slot>\n        </MarketTableAreaTagName>\n      </Host>\n    );\n  }\n\n  disconnectedCallback() {\n    Object.values(this.observers).forEach((observer) => {\n      observer?.disconnect();\n    });\n  }\n}\n"]}