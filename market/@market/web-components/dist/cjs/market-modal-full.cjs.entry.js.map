{"file":"market-modal-full.entry.cjs.js","mappings":"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","names":["MODAL_FULL_ANIMATION_ENTER_TRANSITION_DURATION","MODAL_FULL_ANIMATION_EXIT_TRANSITION_DURATION","getDialogSelector","getNamespacedTagFor","createAndActivateFocusTrap","setupDialogCompactHandler","h","Host"],"sources":["src/components/market-modal-full/market-modal-full.css?tag=market-modal-full&encapsulation=shadow","src/components/market-modal-full/market-modal-full.tsx"],"sourcesContent":["@import \"../../styles/mixins/component-base.css\";\n@import \"../../styles/mixins/modals.css\";\n\n:host {\n  /* TODO: Make this a design token. Based on this Slack convo: https://square.slack.com/archives/G865UJS3B/p1632361735181400 */\n  --modal-full-wide-layout-width: 1200px;\n  --regular-modal-main-horizontal-padding: calc((100vw - var(--modal-full-fixed-layout-width)) / 2);\n  --wide-modal-main-horizontal-padding: calc((100vw - var(--modal-full-wide-layout-width)) / 2);\n\n  @extend %modal-full;\n}\n\n/* sadly you can't use variables in media queries, so here is the math for this breakpoint:\n   --modal-full-fixed-layout-width (600px) + 2 * --modal-full-medium-viewport-horizontal-padding-size (24px) = 648px */\n@media (min-width: 648px) {\n  :host([layout=\"regular\"]) {\n    > :not(.market-header, .market-footer),\n    ::slotted(main),\n    ::slotted(.main) {\n      padding: 0 var(--regular-modal-main-horizontal-padding);\n    }\n  }\n}\n\n/* sadly you can't use variables in media queries, so here is the math for this breakpoint:\n   --modal-full-wide-layout-width (1200px) + 2 * --modal-full-wide-viewport-horizontal-padding-size (40px) = 1280px */\n@media (min-width: 1280px) {\n  :host([layout=\"wide\"]) {\n    > :not(.market-header, .market-footer),\n    ::slotted(main),\n    ::slotted(.main) {\n      padding: 0 var(--wide-modal-main-horizontal-padding);\n    }\n  }\n}\n","import {\n  MODAL_FULL_ANIMATION_ENTER_TRANSITION_DURATION,\n  MODAL_FULL_ANIMATION_EXIT_TRANSITION_DURATION,\n} from '@market/market-theme/js/cjs/index.js';\nimport { Component, Host, Prop, Element, Listen, Method, Event, EventEmitter, h, Watch } from '@stencil/core';\n\nimport {\n  DialogDismissedEvent,\n  DialogLoadedEvent,\n  DialogType,\n  setupDialogCompactHandler,\n  getDialogSelector,\n} from '../../utils/dialog';\nimport {\n  createAndActivateFocusTrap,\n  FocusTrap,\n  FocusTrapActivateOptions,\n  FocusTrapDeactivateOptions,\n  FocusTrapOptions,\n} from '../../utils/focus-trap';\nimport { getNamespacedTagFor } from '../../utils/namespace';\nimport { TMarketHeaderNavigateEventDetail } from '../market-header/events';\n\n@Component({\n  tag: 'market-modal-full',\n  styleUrl: 'market-modal-full.css',\n  shadow: true,\n})\nexport class MarketModalFull {\n  @Element() el: HTMLMarketModalFullElement;\n  connectedCallbackTimeout: NodeJS.Timeout;\n  type: DialogType = 'modal-full';\n  focusTrap: FocusTrap;\n\n  /**\n   * INTERNAL ONLY: Used in CSS to trigger start and stop animations\n   */\n  @Prop({ mutable: true, reflect: true }) hidden: boolean = false;\n\n  /**\n   * INTERNAL ONLY: Used by the context manager to identify a specific dialog/modal\n   */\n  @Prop({ reflect: true, attribute: 'data-dialog-id' }) readonly dialogID: string;\n\n  /**\n   * INTERNAL ONLY: Used by the context manager to identify a specific dialog/modal's place\n   * in the stack\n   */\n  @Prop({ reflect: true, attribute: 'data-dialog-index' }) readonly index: number;\n\n  /**\n   * Sets the layout width for the main content area. Defaults to `regular`, which sets a\n   * a maximum content width of 600px. You can also use `wide` for a max 1248px content area,\n   * or `fluid` to have content fill the whole viewport.\n   */\n  @Prop({ reflect: true }) readonly layout: 'regular' | 'wide' | 'fluid' = 'regular';\n\n  /**\n   * Enforces focus trapping on the modal\n   */\n  @Prop({ mutable: true }) trapFocus: boolean = false;\n\n  /**\n   * The duration for the modal enter animation, set from design tokens\n   */\n  @Prop()\n  readonly animationEnterDuration: number = MODAL_FULL_ANIMATION_ENTER_TRANSITION_DURATION;\n\n  /**\n   * The duration for the modal exit animation, set from design tokens\n   */\n  @Prop()\n  readonly animationExitDuration: number = MODAL_FULL_ANIMATION_EXIT_TRANSITION_DURATION;\n\n  @Watch('layout')\n  layoutWatcher() {\n    this.repositionHeader();\n  }\n\n  /**\n   * Listen to the headerNavigate event emitted by a market-header child component\n   * so we can emit a close event if needed\n   */\n  @Listen('marketHeaderNavigate')\n  headerNavigateEventHandler(event: CustomEvent<TMarketHeaderNavigateEventDetail>) {\n    const { detail, target } = event;\n    // TODO: 'close' should probably come from an enum of some sort\n    if (detail.action === 'close') {\n      // only dismiss if this is the first ancestor dialog\n      if ((target as HTMLElement).closest(getDialogSelector()) === this.el) {\n        this.dismiss();\n      }\n    }\n  }\n\n  /* Instead of doing anything substantial for closing/opening, dialogs just\n  emit events that the parent context can listen to in order to do the heavy\n  lifting of displaying dialogs */\n\n  /**\n   * Triggered when the modal finishes loading\n   */\n  @Event() marketDialogLoaded: EventEmitter<DialogLoadedEvent>;\n\n  /**\n   * Triggered when the modal is dismissed, handled by context manager\n   */\n  @Event() marketDialogDismissed: EventEmitter<DialogDismissedEvent>;\n\n  /**\n   * Triggered when the dialog is fully dismissed\n   */\n  @Event() marketDialogDidDismiss: EventEmitter<DialogDismissedEvent>;\n\n  /* The parent context will handle actually removing elements from the DOM,\n  All the modal needs to do it emit an event so actually closing it can be\n  some other elements problem */\n\n  /**\n   *  Repositions header inside of market-header to align with modal content */\n  repositionHeader() {\n    // since it isn't possible to style slotted child elements, we need to add\n    // classes to the slotted header to apply needed styles to its shadow DOM.\n    const slottedHeader = this.el.querySelector(getNamespacedTagFor('market-header'));\n\n    if (slottedHeader) {\n      slottedHeader.classList.remove('regular', 'wide');\n      switch (this.layout) {\n        case 'regular':\n          slottedHeader.classList.add('regular');\n          break;\n        case 'wide':\n          slottedHeader.classList.add('wide');\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  /**\n   * Emits the dismiss event\n   * The parent context will handle actually removing elements from the DOM,\n   * All the modal needs to do it emit an event so actually closing it can be\n   * some other elements problem\n   */\n  @Method()\n  dismiss(dismissOptions?: Partial<DialogDismissedEvent>) {\n    const { defaultPrevented } = this.marketDialogDismissed.emit({\n      dialog: this.el,\n      type: this.type,\n      origin: dismissOptions?.origin || this.el,\n    });\n\n    if (!defaultPrevented) {\n      this.hidden = true;\n\n      /**\n       * Emit a marketDialogDidDismiss event when modal gets fully dismissed (after animation).\n       */\n      setTimeout(() => {\n        this.marketDialogDidDismiss.emit({\n          dialog: this.el,\n          type: this.type,\n          origin: this.el,\n        });\n      }, this.animationExitDuration);\n    }\n\n    return Promise.resolve();\n  }\n\n  @Watch('trapFocus')\n  onTrapFocusChanged(newValue: boolean, oldValue: boolean) {\n    // only activate/deactivate when the `trapFocus` prop value changes\n    if (newValue !== oldValue) {\n      if (newValue) {\n        this.activateFocusTrap();\n      } else {\n        this.deactivateFocusTrap();\n      }\n    }\n  }\n\n  /**\n   * Activates the focus trap\n   *\n   * See [`focus-trap.ts`](../../utils/focus-trap.ts) for default options\n   *\n   * @param {Object} [options] [focus-trap create options](https://github.com/focus-trap/focus-trap#createoptions)\n   * @param {Object} [activateOptions] set options for [onActivate, onPostActivate, and checkCanFocusTrap](https://github.com/focus-trap/focus-trap#trapactivate)\n   */\n  @Method()\n  activateFocusTrap(options?: FocusTrapOptions, activateOptions?: FocusTrapActivateOptions) {\n    if (this.focusTrap) {\n      this.focusTrap.activate(activateOptions ?? {});\n      if (!this.trapFocus) {\n        this.trapFocus = true;\n      }\n    } else {\n      this.focusTrap = createAndActivateFocusTrap({\n        activateOptions,\n        el: this.el,\n        options,\n      });\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * Deactivates the focus trap\n   *\n   * @param {FocusTrapDeactivateOptions} [deactivateOptions] set options for [onDeactivate, onPostDeactivate, and checkCanReturnFocus](https://github.com/focus-trap/focus-trap#trapdeactivate)\n   */\n  @Method()\n  deactivateFocusTrap(deactivateOptions?: FocusTrapDeactivateOptions) {\n    if (this.focusTrap) {\n      this.focusTrap.deactivate({\n        returnFocus: true,\n        checkCanReturnFocus: (trigger) =>\n          new Promise((resolve) => {\n            if (typeof (trigger as any)?.setFocus === 'function') {\n              (trigger as any).setFocus();\n            } else {\n              resolve(); // node.focus(); will be called by focus-trap\n            }\n          }),\n        ...deactivateOptions,\n      });\n      this.focusTrap = undefined;\n    }\n    return Promise.resolve();\n  }\n\n  connectedCallback() {\n    this.connectedCallbackTimeout = setTimeout(() => {\n      /**\n       * Emit a dialogLoaded event when the component connects. Need this so\n       * the context manager isn't rummaging around it's DOM to try and find the\n       * dialog that was just appended\n       */\n      this.marketDialogLoaded.emit({\n        dialog: this.el,\n        type: this.type,\n      });\n\n      if (this.trapFocus) {\n        this.activateFocusTrap();\n      }\n    }, this.animationEnterDuration);\n  }\n\n  componentWillLoad() {\n    setupDialogCompactHandler(this.el);\n  }\n\n  disconnectedCallback() {\n    this.deactivateFocusTrap();\n\n    /**\n     * Prevents error caused by race conditions during rapid mounting and\n     * unmounting of component by clearing the setTimeout from connectedCallback\n     * if it gets called after disconnectedCallback.\n     */\n    clearTimeout(this.connectedCallbackTimeout);\n  }\n\n  render() {\n    return (\n      <Host class=\"market-modal-full\" role=\"dialog\">\n        <slot onSlotchange={() => this.repositionHeader()}></slot>\n      </Host>\n    );\n  }\n}\n"],"version":3}